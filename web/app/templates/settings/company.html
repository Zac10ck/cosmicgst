{% extends 'base.html' %}

{% block title %}Company Settings - Cosmic Surgical{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-building me-2"></i>Company Settings</h2>
    <a href="{{ url_for('settings.index') }}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left me-1"></i>Back to Settings
    </a>
</div>

<form method="POST" class="needs-validation" novalidate>
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

    <div class="row">
        <div class="col-lg-8">
            <!-- Basic Info -->
            <div class="card mb-4">
                <div class="card-header">
                    <i class="bi bi-info-circle me-1"></i>Business Information
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-8">
                            <label class="form-label">Company Name *</label>
                            <input type="text" class="form-control" name="name" required
                                   value="{{ company.name if company else '' }}"
                                   placeholder="Your Business Name">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Invoice Prefix</label>
                            <input type="text" class="form-control" name="invoice_prefix"
                                   value="{{ company.invoice_prefix if company else 'INV' }}"
                                   placeholder="INV" maxlength="10">
                            <small class="text-muted">e.g., INV, BILL</small>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Invoice Style</label>
                            <select class="form-select" name="invoice_style">
                                <option value="classic" {{ 'selected' if not company or company.invoice_style == 'classic' else '' }}>Classic</option>
                                <option value="modern" {{ 'selected' if company and company.invoice_style == 'modern' else '' }}>Modern</option>
                            </select>
                            <small class="text-muted">PDF design</small>
                        </div>
                        <div class="col-12">
                            <label class="form-label">Address</label>
                            <textarea class="form-control" name="address" rows="3"
                                      placeholder="Full business address">{{ company.address if company else '' }}</textarea>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Phone</label>
                            <input type="tel" class="form-control" name="phone"
                                   value="{{ company.phone if company else '' }}"
                                   placeholder="+91 9876543210">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" name="email"
                                   value="{{ company.email if company else '' }}"
                                   placeholder="business@example.com">
                        </div>
                    </div>
                </div>
            </div>

            <!-- GST Info -->
            <div class="card mb-4">
                <div class="card-header">
                    <i class="bi bi-percent me-1"></i>GST Information
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">GSTIN *</label>
                            <input type="text" class="form-control" name="gstin"
                                   value="{{ company.gstin if company else '' }}"
                                   placeholder="22AAAAA0000A1Z5" maxlength="15"
                                   pattern="[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}">
                            <small class="text-muted">15-character GST Identification Number</small>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">PAN</label>
                            <input type="text" class="form-control" name="pan"
                                   value="{{ company.pan if company else '' }}"
                                   placeholder="AAAAA0000A" maxlength="10">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">State Code *</label>
                            <select class="form-select" name="state_code" required>
                                {% for code, name in state_codes %}
                                <option value="{{ code }}"
                                    {{ 'selected' if company and company.state_code == code else ('selected' if code == '32' and not company) }}>
                                    {{ name }}
                                </option>
                                {% endfor %}
                            </select>
                            <small class="text-muted">Used for CGST/SGST vs IGST calculation</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bank Details -->
            <div class="card mb-4">
                <div class="card-header">
                    <i class="bi bi-bank me-1"></i>Bank Details
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Bank Name</label>
                            <input type="text" class="form-control" name="bank_name"
                                   value="{{ company.bank_name if company else '' }}"
                                   placeholder="State Bank of India">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Account Number</label>
                            <input type="text" class="form-control" name="bank_account"
                                   value="{{ company.bank_account if company else '' }}"
                                   placeholder="1234567890">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">IFSC Code</label>
                            <input type="text" class="form-control" name="bank_ifsc"
                                   value="{{ company.bank_ifsc if company else '' }}"
                                   placeholder="SBIN0001234" maxlength="11">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Invoice Terms -->
            <div class="card mb-4">
                <div class="card-header">
                    <i class="bi bi-file-text me-1"></i>Invoice Terms & Conditions
                </div>
                <div class="card-body">
                    <textarea class="form-control" name="invoice_terms" rows="4"
                              placeholder="Terms and conditions that appear on invoices...">{{ company.invoice_terms if company else '' }}</textarea>
                    <small class="text-muted">These terms will appear at the bottom of invoices</small>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <!-- Preview -->
            <div class="card sticky-top" style="top: 80px;">
                <div class="card-header">
                    <i class="bi bi-eye me-1"></i>Invoice Header Preview
                </div>
                <div class="card-body">
                    <div class="border p-3 bg-light">
                        <h5 class="mb-1">{{ company.name if company and company.name else 'Your Company Name' }}</h5>
                        <p class="mb-1 small">{{ company.address if company and company.address else 'Your Address' }}</p>
                        {% if company and company.gstin %}
                        <p class="mb-0 small"><strong>GSTIN:</strong> {{ company.gstin }}</p>
                        {% endif %}
                    </div>
                </div>
                <div class="card-footer">
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="bi bi-check-circle me-1"></i>Save Settings
                    </button>
                </div>
            </div>
        </div>
    </div>
</form>
{% endblock %}
