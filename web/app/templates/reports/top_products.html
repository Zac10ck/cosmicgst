{% extends 'base.html' %}

{% block title %}Top Products Report - Cosmic Surgical{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-trophy me-2"></i>Top Products Report</h2>
    <a href="{{ url_for('reports.index') }}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left me-1"></i>Back
    </a>
</div>

<!-- Filters -->
<div class="card mb-4">
    <div class="card-body">
        <form method="GET" class="row g-3">
            <div class="col-md-3">
                <label class="form-label">Start Date</label>
                <input type="date" class="form-control" name="start_date" value="{{ start_date.isoformat() }}">
            </div>
            <div class="col-md-3">
                <label class="form-label">End Date</label>
                <input type="date" class="form-control" name="end_date" value="{{ end_date.isoformat() }}">
            </div>
            <div class="col-md-3">
                <label class="form-label">Show Top</label>
                <select class="form-select" name="limit">
                    <option value="10" {{ 'selected' if limit == 10 }}>10 Products</option>
                    <option value="20" {{ 'selected' if limit == 20 }}>20 Products</option>
                    <option value="50" {{ 'selected' if limit == 50 }}>50 Products</option>
                    <option value="100" {{ 'selected' if limit == 100 }}>100 Products</option>
                </select>
            </div>
            <div class="col-md-3 d-flex align-items-end">
                <button type="submit" class="btn btn-primary w-100">
                    <i class="bi bi-filter me-1"></i>Apply
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Summary -->
<div class="row mb-4">
    <div class="col-md-6">
        <div class="card bg-primary text-white">
            <div class="card-body text-center">
                <h6 class="card-subtitle mb-2 opacity-75">Total Revenue (Top {{ limit }})</h6>
                <h3 class="card-title mb-0">Rs. {{ "%.2f"|format(total_revenue) }}</h3>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card bg-success text-white">
            <div class="card-body text-center">
                <h6 class="card-subtitle mb-2 opacity-75">Total Quantity Sold</h6>
                <h3 class="card-title mb-0">{{ "%.0f"|format(total_qty) }} units</h3>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Top by Revenue -->
    <div class="col-lg-6">
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="bi bi-currency-rupee me-2"></i>Top Products by Revenue</h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>#</th>
                                <th>Product</th>
                                <th class="text-end">Revenue</th>
                                <th class="text-center">Sales</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for product in top_by_revenue %}
                            <tr>
                                <td>
                                    {% if loop.index <= 3 %}
                                    <span class="badge bg-{{ 'warning' if loop.index == 1 else 'secondary' }}">
                                        {{ loop.index }}
                                    </span>
                                    {% else %}
                                    {{ loop.index }}
                                    {% endif %}
                                </td>
                                <td>
                                    <strong>{{ product.product_name[:30] }}{% if product.product_name|length > 30 %}...{% endif %}</strong>
                                    {% if product.hsn_code %}
                                    <br><small class="text-muted">HSN: {{ product.hsn_code }}</small>
                                    {% endif %}
                                </td>
                                <td class="text-end">
                                    <strong>Rs. {{ "%.2f"|format(product.total_revenue) }}</strong>
                                </td>
                                <td class="text-center">{{ product.times_sold }}x</td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="4" class="text-center text-muted py-4">No data available</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Top by Quantity -->
    <div class="col-lg-6">
        <div class="card mb-4">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="bi bi-box-seam me-2"></i>Top Products by Quantity</h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>#</th>
                                <th>Product</th>
                                <th class="text-end">Qty Sold</th>
                                <th class="text-center">Sales</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for product in top_by_qty %}
                            <tr>
                                <td>
                                    {% if loop.index <= 3 %}
                                    <span class="badge bg-{{ 'warning' if loop.index == 1 else 'secondary' }}">
                                        {{ loop.index }}
                                    </span>
                                    {% else %}
                                    {{ loop.index }}
                                    {% endif %}
                                </td>
                                <td>
                                    <strong>{{ product.product_name[:30] }}{% if product.product_name|length > 30 %}...{% endif %}</strong>
                                    {% if product.hsn_code %}
                                    <br><small class="text-muted">HSN: {{ product.hsn_code }}</small>
                                    {% endif %}
                                </td>
                                <td class="text-end">
                                    <strong>{{ "%.2f"|format(product.total_qty) }}</strong>
                                </td>
                                <td class="text-center">{{ product.times_sold }}x</td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="4" class="text-center text-muted py-4">No data available</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
